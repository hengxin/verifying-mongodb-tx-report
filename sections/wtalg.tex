% wtalg.tex

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \fig{width = 0.75\textwidth}{figs/wt}

  \[
	\wtalg \models \strongsi
  \]
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
	每个 \wtalg{} 事务 $\txnvar \in \WTTXN$ 有一个唯一标识号 \\[5pt]
	$\txnvar.\tid \in \TID = \mathbb{N} \cup \set{-1, \wttidnone}$
  \end{center}

  \vspace{0.50cm}
  \begin{itemize}
	\setlength{\itemsep}{10pt}
	\item 事务开始时 (\wtstart), $\txnvar.\tid = 0$
	\item 事务第一个写操作成功执行后 (\wtupdate), $\txnvar.\tid > 0$
	\item 事务因写冲突回滚时 (\wtrollback), $\txnvar.\tid = -1$
  \end{itemize}

  \vspace{0.20cm}
  \begin{center}
	对于只读事务 $\txnvar$, 始终有 $\txnvar.\tid = 0$
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{itemize}
	\setlength{\itemsep}{10pt}
	\item 客户端通过会话 (Session) 与 WiredTiger 进行交互
	\item 每个会话有一个唯一会话标识号 $\wtsidvar \in \WTSID = \mathbb{N}$
	\item WiredTiger 维护数据结构 $\wttxnglobal \in [\currenttid : \TID, \states : \WTSID \to \TID]$
	  \vspace{5pt}
	  \begin{description}
		\setlength{\itemsep}{5pt}
		\item[$\currenttid:$] 当前分配的最大事务标识号
		\item[$\states:$] 会话与会话之上当前事务之间的映射关系
	  \end{description}
  \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
	每个事务只能观察到在它开始之前提交的事务
	\[
	  \wtalg \models \rtsi
	\]

	\pause
	\vspace{0.30cm}
	每个事务在开始时 (\wtstart) 根据 \\[5pt]
	$\wttxnglobal$ 维护的信息确定它的``读快照''

	\vspace{0.60cm}
	\wtalg{} 事务协议从反面入手计算, 排除不可见事务集合
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \begin{center}
	每个事务 $\txnvar$ 维护以下信息:
  \end{center}
  \begin{description}[$\txnvar.\snapmax:$]
	\setlength{\itemsep}{5pt}
	\item[$\txnvar.\snapshot:$] 正在进行的、已获取事务标识号的事务集合
	\item[$\txnvar.\snapmax:$] $\txnvar$ 开始时, 当前最大的事务标识号
  \end{description}

  \[
	\wttxnglobal \in [\currenttid : \TID, \states : \WTSID \to \TID]
  \]
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
  \input{procedures/wt-visible}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{}
\end{frame}
%%%%%%%%%%%%%%%%%%%%